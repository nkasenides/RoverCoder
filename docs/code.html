
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Rover Coder - Προγραμματισμός</title>
    <script src="blockly/blockly_compressed.js"></script>
    <script src="blockly/blocks_compressed.js"></script>
    <script src="blockly/javascript_compressed.js"></script>
    <script src="blockly/msg/js/en.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="js/materialize.min.js"></script>
    <script src="js/init.js"></script>

    <!--Custom blocks-->
    <script src="rover-blocks/rover-block-definitions.js"></script>
    <script defer src="rover-blocks/rover-block-codes.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/materialize.css">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body onload="loadToolbox()">

<div id="blocklyDiv" style="height: 480px;"></div>

<div id="errorModal" class="modal center-align">
    <div class="modal-content">
        <h4>Error</h4>
        <i class="material-icons large red-text">warning</i>
        <p id="errorModalContent">No workspace found</p>
    </div>
    <div class="modal-footer">
        <a href="index.html" class="modal-close waves-effect waves-red btn-flat">Go back</a>
    </div>
</div>

<a class="btn waves-effect green white-text" onclick="compile()">Compile to JS</a>

<div id="code" style="font-family: 'Courier New',serif;"></div>

<script>

    const codeElement = document.getElementById("code");
    let workspace = null;

    /**
     * Loads the toolbox from rover-toolbox.xml into the page.
     */
    function loadToolbox() {
        fetch("rover-blocks/rover-toolbox.xml")
            .then(response => response.text())
            .then(data => {
                let lines = data.split("\n");
                lines[0] = ""; lines[lines.length-1] = "";
                lines.join("\n");
                const bodyElement = document.body;
                let xmlElement = document.createElement("xml");
                xmlElement.innerHTML = data;
                bodyElement.appendChild(xmlElement);
                workspace = initializeWorkspace();
            })
            .catch(error => {
                let errorModal = M.Modal.getInstance(document.getElementById("errorModal"));
                let errorModalContentElement = document.getElementById("errorModalContent");
                errorModalContentElement.innerText = error;
                errorModal.options.dismissible = false;
                errorModal.open();
            });
    }

    function initializeWorkspace() {
        return roverWorkspace = Blockly.inject(
            'blocklyDiv',
            {
                media: 'blockly/media/',
                toolbox: document.getElementById('toolbox'),
                zoom: {
                    controls: true,
                    wheel: true,
                    startScale: 1.0,
                    maxScale: 3,
                    minScale: 0.3,
                    scaleSpeed: 1.2
                },
                trashcan: true
            }
        );
    }

    function compile() {
        const jsCode = Blockly.JavaScript.workspaceToCode(workspace);
        codeElement.innerText = jsCode;
    }



</script>

</body>
</html>
